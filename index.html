</div>
    
    <script>
// Learning Notebook - Vanilla JavaScript Implementation
class LearningNotebook {
    constructor() {
        this.container = document.getElementById('container');
        this.canvas = document.getElementById('canvas');
        this.ctx = this.canvas.getContext('2d');
        this.boxesContainer = document.getElementById('boxes-container');
        this.settingsPanel = document.getElementById('settings-panel');
        this.fabButton = document.getElementById('fab-button');
        this.radialMenu = document.getElementById('radial-menu');
        this.fileInput = document.getElementById('file-input');
        
        // State
        this.menuOpen = false;
        this.mode = 'none'; // none | draw | text | link | erase
        this.settingsVisible = false;
        this.strokes = [];
        this.currentStroke = null;
        this.drawing = false;
        this.brushSize = 3;
        this.brushColor = '#ffffff';
        this.brushStyle = 'round';
        this.boxes = [];
        this.selectedBox = null;
        this.lastPointer = { x: 200, y: 200 };
        this.dragState = {};
        this.GRID = 32;
        
        this.init();
    }
    
    init() {
        this.setupCanvas();
        this.bindEvents();
        this.setupRadialMenu();
        this.render();
    }
    
    setupCanvas() {
        const resizeCanvas = () => {
            const rect = this.canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            this.canvas.width = rect.width * dpr;
            this.canvas.height = rect.height * dpr;
            this.ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
            this.redrawCanvas();
        };
        
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
    }
    
    redrawCanvas() {
        const rect = this.canvas.getBoundingClientRect();
        this.ctx.clearRect(0, 0, rect.width, rect.height);
        
        // Draw strokes
        for (const stroke of this.strokes) {
            if (!stroke.points || stroke.points.length === 0) continue;
            this.ctx.lineJoin = stroke.style || 'round';
            this.ctx.lineCap = stroke.style || 'round';
            this.ctx.strokeStyle = stroke.color;
            this.ctx.lineWidth = stroke.size;
            this.ctx.beginPath();
            this.ctx.moveTo(stroke.points[0].x, stroke.points[0].y);
            for (let i = 1; i < stroke.points.length; i++) {
                this.ctx.lineTo(stroke.points[i].x, stroke.points[i].y);
            }
            this.ctx.stroke();
        }
        
        // Draw current stroke
        if (this.currentStroke && this.currentStroke.points.length > 0) {
            this.ctx.lineJoin = this.currentStroke.style || 'round';
            this.ctx.lineCap = this.currentStroke.style || 'round';
            this.ctx.strokeStyle = this.currentStroke.color;
            this.ctx.lineWidth = this.currentStroke.size;
            this.ctx.beginPath();
            this.ctx.moveTo(this.currentStroke.points[0].x, this.currentStroke.points[0].y);
            for (let i = 1; i < this.currentStroke.points.length; i++) {
                this.ctx.lineTo(this.currentStroke.points[i].x, this.currentStroke.points[i].y);
            }
            this.ctx.stroke();
        }
    }
    
    getPointerPos(e) {
        const rect = this.container.getBoundingClientRect();
        return {
            x: Math.round(e.clientX - rect.left),
            y: Math.round(e.clientY - rect.top)
        };
    }
    
    snapToGrid(x, y) {
        return {
            x: Math.round(x / this.GRID) * this.GRID,
            y: Math.round(y / this.GRID) * this.GRID
        };
    }
    
    bindEvents() {
        // FAB button
        this.fabButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log('FAB clicked, current menuOpen:', this.menuOpen);
            this.toggleMenu();
        });
        
        // Canvas events for drawing
        this.canvas.addEventListener('pointerdown', (e) => {
            const pos = this.getPointerPos(e);
            if (this.mode === 'draw') {
                this.drawing = true;
                this.currentStroke = {
                    color: this.brushColor,
                    size: this.brushSize,
                    style: this.brushStyle,
                    points: [pos]
                };
            } else if (this.mode === 'erase') {
                this.eraseAt(pos);
            }
        });
        
        window.addEventListener('pointermove', (e) => {
            const pos = this.getPointerPos(e);
            this.lastPointer = pos;
            
            if (this.mode === 'draw' && this.drawing && this.currentStroke) {
                this.currentStroke.points.push(pos);
                this.redrawCanvas();
            } else if (this.mode === 'erase' && e.buttons === 1) {
                this.eraseAt(pos);
            }
            
            // Handle box dragging
            if (this.dragState.dragging) {
                const dx = pos.x - this.dragState.startX;
                const dy = pos.y - this.dragState.startY;
                const newX = Math.round((this.dragState.origX + dx) / this.GRID) * this.GRID;
                const newY = Math.round((this.dragState.origY + dy) / this.GRID) * this.GRID;
                this.updateBox(this.dragState.id, { x: newX, y: newY });
            }
        });
        
        window.addEventListener('pointerup', () => {
            if (this.mode === 'draw' && this.drawing) {
                this.drawing = false;
                if (this.currentStroke) {
                    this.strokes.push(this.currentStroke);
                    this.currentStroke = null;
                    this.redrawCanvas();
                }
            }
            
            if (this.dragState.dragging) {
                this.dragState = {};
            }
        });
        
        // Container clicks for placing text/links
        this.container.addEventListener('pointerdown', (e) => {
            // Ignore clicks on UI elements
            if (e.target.closest('.settings-panel') || 
                e.target.closest('.fab-container') || 
                e.target.closest('.radial-menu') ||
                e.target.closest('.notebook-box') ||
                e.target.closest('.helper-tooltip')) {
                return;
            }
            
            const pos = this.getPointerPos(e);
            console.log('Container clicked, mode:', this.mode, 'pos:', pos);
            
            if (this.mode === 'text') {
                e.preventDefault();
                e.stopPropagation();
                this.addTextAt(pos);
            } else if (this.mode === 'link') {
                e.preventDefault(); 
                e.stopPropagation();
                this.addLinkAt(pos);
            }
        });
        
        // File input
        this.fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                this.handleImageFile(file);
                e.target.value = '';
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Delete' || e.key === 'Backspace') {
                if (this.selectedBox && !e.target.closest('.text-box-content')) {
                    this.deleteSelectedBox();
                }
            }
            if (e.key === 'Escape') {
                this.closeSettings();
                this.setMode('none');
            }
            // Ctrl+S to save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                this.saveToGitHub();
            }
            // Ctrl+O to load  
            if (e.ctrlKey && e.key === 'o') {
                e.preventDefault();
                this.loadFromGitHub();
            }
        });
    }
    
    setupRadialMenu() {
        const buttons = this.radialMenu.querySelectorAll('.radial-button');
        buttons.forEach((btn, index) => {
            const angle = parseInt(btn.dataset.angle);
            const radius = 80; // Distance from FAB center
            const radian = (angle * Math.PI) / 180;
            
            // Calculate position - buttons should be positioned relative to the FAB center
            // FAB is at (28, 28) within the menu container, so we offset from there
            const centerX = 28; // FAB center X in menu container
            const centerY = 28; // FAB center Y in menu container
            
            const x = centerX + Math.cos(radian) * radius;
            const y = centerY + Math.sin(radian) * radius;
            
            console.log(`Button ${index} (${angle}°): x=${x}, y=${y}`);
            
            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
            btn.style.transform = 'translate(-50%, -50%)';
            
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                const mode = btn.dataset.mode;
                console.log('Radial button clicked:', mode);
                if (mode === 'image') {
                    this.fileInput.click();
                    this.closeMenu();
                } else if (mode === 'save') {
                    this.saveToGitHub();
                    this.closeMenu();
                } else if (mode) {
                    this.setMode(mode);
                }
            });
        });
    }
    
    toggleMenu() {
        this.menuOpen = !this.menuOpen;
        console.log('Menu toggled to:', this.menuOpen);
        this.fabButton.classList.toggle('open', this.menuOpen);
        this.radialMenu.classList.toggle('hidden', !this.menuOpen);
        
        const plusIcon = this.fabButton.querySelector('.fab-plus');
        const xIcon = this.fabButton.querySelector('.fab-x');
        
        if (this.menuOpen) {
            plusIcon.classList.add('hidden');
            xIcon.classList.remove('hidden');
        } else {
            plusIcon.classList.remove('hidden');
            xIcon.classList.add('hidden');
        }
    }
    
    closeMenu() {
        this.menuOpen = false;
        this.fabButton.classList.remove('open');
        this.radialMenu.classList.add('hidden');
        
        const plusIcon = this.fabButton.querySelector('.fab-plus');
        const xIcon = this.fabButton.querySelector('.fab-x');
        plusIcon.classList.remove('hidden');
        xIcon.classList.add('hidden');
    }
    
    setMode(mode) {
        console.log('Setting mode to:', mode);
        this.mode = mode;
        this.closeMenu();
        this.showSettings();
    }
    
    showSettings() {
        this.settingsVisible = true;
        this.settingsPanel.classList.remove('hidden');
        this.renderSettings();
    }
    
    closeSettings() {
        this.settingsVisible = false;
        this.settingsPanel.classList.add('hidden');
    }
    
    renderSettings() {
        const selectedBox = this.boxes.find(b => b.id === this.selectedBox);
        
        if (selectedBox) {
            this.renderBoxSettings(selectedBox);
        } else if (this.settingsVisible) {
            this.renderModeSettings();
        }
    }
    
    renderBoxSettings(box) {
        let content = '';
        
        if (box.type === 'text') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container edit">
                            <svg class="settings-icon edit" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 20h9"/>
                                <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Szerkesztés</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="settings-close-btn" onclick="notebook.selectedBox = null; notebook.renderSettings();">Bezár</button>
                        <button class="settings-delete-btn" onclick="notebook.deleteSelectedBox();">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"/>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                            </svg>
                            Törlés
                        </button>
                    </div>
                </div>
                
                <div class="settings-content">
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-icon-container">
                                <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="13.5" cy="6.5" r=".5"/>
                                    <circle cx="17.5" cy="10.5" r=".5"/>
                                    <circle cx="8.5" cy="7.5" r=".5"/>
                                    <circle cx="6.5" cy="11.5" r=".5"/>
                                    <circle cx="12.5" cy="13.5" r=".5"/>
                                    <circle cx="16.5" cy="17.5" r=".5"/>
                                    <circle cx="6.5" cy="17.5" r=".5"/>
                                </svg>
                            </div>
                            <span class="setting-label-text">Szín</span>
                        </div>
                        <input type="color" class="color-input" value="${box.color}" onchange="notebook.updateBox(${box.id}, {color: this.value})">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <div class="setting-label">
                                <div class="setting-icon-container">
                                    <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="4" y1="21" x2="4" y2="14"/>
                                        <line x1="4" y1="10" x2="4" y2="3"/>
                                        <line x1="12" y1="21" x2="12" y2="12"/>
                                        <line x1="12" y1="8" x2="12" y2="3"/>
                                        <line x1="20" y1="21" x2="20" y2="16"/>
                                        <line x1="20" y1="12" x2="20" y2="3"/>
                                        <line x1="1" y1="14" x2="7" y2="14"/>
                                        <line x1="9" y1="8" x2="15" y2="8"/>
                                        <line x1="17" y1="16" x2="23" y2="16"/>
                                    </svg>
                                </div>
                                <span class="setting-label-text">Méret</span>
                            </div>
                            <span class="slider-value">${box.fontSize}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="10" max="72" value="${box.fontSize}" oninput="notebook.updateBox(${box.id}, {fontSize: parseInt(this.value)}); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 24px;">
                        <select class="style-select" onchange="notebook.updateBox(${box.id}, {fontFamily: this.value})">
                            <option value="sans-serif" ${box.fontFamily === 'sans-serif' ? 'selected' : ''}>Sans-serif</option>
                            <option value="serif" ${box.fontFamily === 'serif' ? 'selected' : ''}>Serif</option>
                            <option value="monospace" ${box.fontFamily === 'monospace' ? 'selected' : ''}>Monospace</option>
                        </select>
                        
                        <div class="format-buttons">
                            <button class="format-button ${box.fontWeight === '700' ? 'active' : ''}" onclick="notebook.updateBox(${box.id}, {fontWeight: this.classList.contains('active') ? '400' : '700'}); this.classList.toggle('active');">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                                </svg>
                            </button>
                            <button class="format-button ${box.fontStyle === 'italic' ? 'active' : ''}" onclick="notebook.updateBox(${box.id}, {fontStyle: this.classList.contains('active') ? 'normal' : 'italic'}); this.classList.toggle('active');">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="19" y1="4" x2="10" y2="4"/>
                                    <line x1="14" y1="20" x2="5" y2="20"/>
                                    <line x1="15" y1="4" x2="9" y2="20"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span class="setting-label-text">Szélesség</span>
                            <span class="slider-value">${box.width}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="80" max="800" value="${box.width}" oninput="notebook.updateBox(${box.id}, {width: parseInt(this.value)}); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span class="setting-label-text">Magasság</span>
                            <span class="slider-value">${box.height}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="40" max="400" value="${box.height}" oninput="notebook.updateBox(${box.id}, {height: parseInt(this.value)}); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                </div>
            `;
        } else if (box.type === 'link') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container link">
                            <svg class="settings-icon link" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Szerkesztés</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="settings-close-btn" onclick="notebook.selectedBox = null; notebook.renderSettings();">Bezár</button>
                        <button class="settings-delete-btn" onclick="notebook.deleteSelectedBox();">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"/>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                            </svg>
                            Törlés
                        </button>
                    </div>
                </div>
                
                <div class="settings-content">
                    <div style="margin-bottom: 24px;">
                        <div style="margin-bottom: 8px;">
                            <span class="setting-label-text">URL</span>
                        </div>
                        <input type="url" style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 12px 16px; color: white;" placeholder="https://..." value="${box.url}" oninput="notebook.updateBox(${box.id}, {url: this.value, text: this.value})">
                    </div>
                    
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-icon-container">
                                <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="13.5" cy="6.5" r=".5"/>
                                    <circle cx="17.5" cy="10.5" r=".5"/>
                                    <circle cx="8.5" cy="7.5" r=".5"/>
                                    <circle cx="6.5" cy="11.5" r=".5"/>
                                    <circle cx="12.5" cy="13.5" r=".5"/>
                                    <circle cx="16.5" cy="17.5" r=".5"/>
                                    <circle cx="6.5" cy="17.5" r=".5"/>
                                </svg>
                            </div>
                            <span class="setting-label-text">Szín</span>
                        </div>
                        <input type="color" class="color-input" value="${box.color}" onchange="notebook.updateBox(${box.id}, {color: this.value})">
                    </div>
                </div>
            `;
        } else if (box.type === 'image') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container edit">
                            <svg class="settings-icon edit" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                <circle cx="9" cy="9" r="2"/>
                                <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Kép beállítások</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="settings-close-btn" onclick="notebook.selectedBox = null; notebook.renderSettings();">Bezár</button>
                        <button class="settings-delete-btn" onclick="notebook.deleteSelectedBox();">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"/>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                            </svg>
                            Törlés
                        </button>
                    </div>
                </div>
                
                <div class="settings-content">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span class="setting-label-text">Szélesség</span>
                            <span class="slider-value">${box.width}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="40" max="1000" value="${box.width}" oninput="notebook.updateBox(${box.id}, {width: parseInt(this.value)}); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <span class="setting-label-text">Magasság</span>
                            <span class="slider-value">${box.height}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="40" max="800" value="${box.height}" oninput="notebook.updateBox(${box.id}, {height: parseInt(this.value)}); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                </div>
            `;
        }
        
        this.settingsPanel.innerHTML = content;
    }
    
    renderModeSettings() {
        let content = '';
        
        if (this.mode === 'draw') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container draw">
                            <svg class="settings-icon draw" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Toll beállítások</span>
                    </div>
                    <button class="settings-close-btn" onclick="notebook.closeSettings();">Bezár</button>
                </div>
                
                <div class="settings-content">
                    <div class="setting-row">
                        <div class="setting-label">
                            <div class="setting-icon-container">
                                <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="13.5" cy="6.5" r=".5"/>
                                    <circle cx="17.5" cy="10.5" r=".5"/>
                                    <circle cx="8.5" cy="7.5" r=".5"/>
                                    <circle cx="6.5" cy="11.5" r=".5"/>
                                    <circle cx="12.5" cy="13.5" r=".5"/>
                                    <circle cx="16.5" cy="17.5" r=".5"/>
                                    <circle cx="6.5" cy="17.5" r=".5"/>
                                </svg>
                            </div>
                            <span class="setting-label-text">Szín</span>
                        </div>
                        <input type="color" class="color-input" value="${this.brushColor}" onchange="notebook.brushColor = this.value">
                    </div>
                    
                    <div class="slider-container">
                        <div class="slider-label">
                            <div class="setting-label">
                                <div class="setting-icon-container">
                                    <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="4" y1="21" x2="4" y2="14"/>
                                        <line x1="4" y1="10" x2="4" y2="3"/>
                                        <line x1="12" y1="21" x2="12" y2="12"/>
                                        <line x1="12" y1="8" x2="12" y2="3"/>
                                        <line x1="20" y1="21" x2="20" y2="16"/>
                                        <line x1="20" y1="12" x2="20" y2="3"/>
                                        <line x1="1" y1="14" x2="7" y2="14"/>
                                        <line x1="9" y1="8" x2="15" y2="8"/>
                                        <line x1="17" y1="16" x2="23" y2="16"/>
                                    </svg>
                                </div>
                                <span class="setting-label-text">Méret</span>
                            </div>
                            <span class="slider-value">${this.brushSize}px</span>
                        </div>
                        <input type="range" class="brush-slider" min="1" max="40" value="${this.brushSize}" oninput="notebook.brushSize = parseInt(this.value); this.parentElement.querySelector('.slider-value').textContent = this.value + 'px'">
                    </div>
                    
                    <div class="style-controls">
                        <div class="setting-label">
                            <div class="setting-icon-container">
                                <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                </svg>
                            </div>
                            <span class="setting-label-text">Stílus</span>
                        </div>
                        <select class="style-select" onchange="notebook.<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Notebook</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    overflow: hidden;
}

.hidden {
    display: none !important;
}

.container {
    width: 100vw;
    height: 100vh;
    background-color: #000;
    position: relative;
    user-select: none;
    overflow: hidden;
}

/* Grid Background */
.grid-background {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-color: #000;
    background-image: 
        linear-gradient(#2f2f2f 1px, transparent 1px), 
        linear-gradient(90deg, #2f2f2f 1px, transparent 1px);
    background-size: 32px 32px;
    opacity: 0.25;
}

/* Canvas */
.drawing-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    touch-action: none;
}

/* Content Boxes */
.notebook-box {
    position: absolute;
    transition: all 0.2s ease;
    z-index: 40;
}

.notebook-box.selected {
    z-index: 60;
    transform: scale(1.02);
}

.notebook-box.selected .text-box-content,
.notebook-box.selected .link-box-content {
    background: rgba(255, 255, 255, 0.08) !important;
    border: 2px solid rgba(59, 130, 246, 0.5) !important;
}

.notebook-box.selected .image-box-content {
    border: 2px solid rgba(59, 130, 246, 0.5) !important;
}

.text-box-content {
    color: #ffffff;
    outline: none;
    background: rgba(255, 255, 255, 0.02);
    padding: 12px;
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.2s ease;
    width: 100%;
    height: 100%;
    resize: none;
    overflow: hidden;
    font-family: inherit;
}

.text-box-content::placeholder {
    color: rgba(255, 255, 255, 0.4);
}

.link-box-content {
    color: #9be2ff;
    background: rgba(255, 255, 255, 0.02);
    padding: 12px;
    border-radius: 16px;
    border: 1px dashed rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: all 0.2s ease;
    height: 100%;
    display: flex;
    align-items: center;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.link-box-content:hover {
    background: rgba(255, 255, 255, 0.1);
}

.link-icon {
    width: 16px;
    height: 16px;
    margin-right: 8px;
    opacity: 0.7;
}

.image-box-content {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.image-box-content:hover {
    opacity: 0.9;
}

/* Settings Panel */
.settings-panel {
    position: fixed;
    top: 24px;
    left: 50%;
    transform: translateX(-50%);
    width: 384px;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(32px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 24px;
    padding: 24px;
    z-index: 50;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    color: white;
}

.settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
}

.settings-title {
    display: flex;
    align-items: center;
    gap: 12px;
}

.settings-icon-container {
    width: 40px;
    height: 40px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.settings-icon-container.draw {
    background: rgba(59, 130, 246, 0.2);
}

.settings-icon-container.text {
    background: rgba(34, 197, 94, 0.2);
}

.settings-icon-container.link {
    background: rgba(147, 51, 234, 0.2);
}

.settings-icon-container.edit {
    background: rgba(156, 163, 175, 0.2);
}

.settings-icon {
    width: 20px;
    height: 20px;
}

.settings-icon.draw {
    color: #60a5fa;
}

.settings-icon.text {
    color: #4ade80;
}

.settings-icon.link {
    color: #a855f7;
}

.settings-icon.edit {
    color: #9ca3af;
}

.settings-title-text {
    font-weight: 600;
    font-size: 18px;
    color: white;
}

.settings-close-btn {
    padding: 8px 16px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
}

.settings-close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.settings-delete-btn {
    padding: 8px 16px;
    border-radius: 20px;
    background: rgba(239, 68, 68, 0.8);
    border: none;
    color: white;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

.settings-delete-btn:hover {
    background: rgba(239, 68, 68, 1);
}

.settings-content {
    color: white;
}

.setting-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
}

.setting-label {
    display: flex;
    align-items: center;
    gap: 12px;
}

.setting-icon-container {
    width: 32px;
    height: 32px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
}

.setting-icon {
    width: 16px;
    height: 16px;
    color: rgba(255, 255, 255, 0.7);
}

.setting-label-text {
    font-size: 14px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.9);
}

.color-input {
    width: 48px;
    height: 40px;
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.05);
    cursor: pointer;
    transition: all 0.2s ease;
}

.color-input:hover {
    border-color: rgba(255, 255, 255, 0.4);
    transform: scale(1.05);
}

.slider-container {
    margin-bottom: 24px;
}

.slider-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.slider-value {
    color: rgba(255, 255, 255, 0.7);
    font-weight: 500;
}

.brush-slider {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    appearance: none;
    cursor: pointer;
}

.brush-slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    cursor: pointer;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4), 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
}

.brush-slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(99, 102, 241, 0.5), 0 3px 6px rgba(0, 0, 0, 0.3);
}

.brush-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    cursor: pointer;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4), 0 2px 4px rgba(0, 0, 0, 0.2);
}

.style-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
}

.style-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    padding: 8px 16px;
    color: white;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.style-select:hover {
    background: rgba(255, 255, 255, 0.15);
}

.style-select option {
    background: #1f2937;
    color: white;
}

.format-buttons {
    display: flex;
    gap: 12px;
}

.format-button {
    padding: 8px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.7);
}

.format-button:hover {
    background: rgba(255, 255, 255, 0.2);
}

.format-button.active {
    background: rgba(59, 130, 246, 0.8);
    color: white;
}

.quick-colors {
    padding-top: 8px;
}

.quick-colors-label {
    font-size: 14px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 12px;
}

.quick-colors-grid {
    display: flex;
    gap: 12px;
}

.quick-color-btn {
    padding: 8px 16px;
    border-radius: 12px;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
}

.quick-color-btn.white {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.1);
    color: white;
}

.quick-color-btn.white:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.2);
}

.quick-color-btn.yellow {
    background: rgba(234, 179, 8, 0.15);
    border-color: rgba(234, 179, 8, 0.2);
    color: #fde047;
}

.quick-color-btn.yellow:hover {
    background: rgba(234, 179, 8, 0.25);
    border-color: rgba(234, 179, 8, 0.3);
}

.quick-color-btn.green {
    background: rgba(34, 197, 94, 0.15);
    border-color: rgba(34, 197, 94, 0.2);
    color: #4ade80;
}

.quick-color-btn.green:hover {
    background: rgba(34, 197, 94, 0.25);
    border-color: rgba(34, 197, 94, 0.3);
}

.quick-color-btn.red {
    background: rgba(239, 68, 68, 0.15);
    border-color: rgba(239, 68, 68, 0.2);
    color: #f87171;
}

.quick-color-btn.red:hover {
    background: rgba(239, 68, 68, 0.25);
    border-color: rgba(239, 68, 68, 0.3);
}

.info-box {
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.info-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 16px;
}

.info-item:last-child {
    margin-bottom: 0;
}

.info-icon-container {
    width: 24px;
    height: 24px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 2px;
}

.info-icon-container.green {
    background: rgba(34, 197, 94, 0.2);
}

.info-icon-container.blue {
    background: rgba(59, 130, 246, 0.2);
}

.info-icon-container.purple {
    background: rgba(147, 51, 234, 0.2);
}

.info-text {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
    line-height: 1.5;
}

/* FAB and Radial Menu */
.fab-container {
    position: fixed;
    top: 24px;
    left: 24px;
    z-index: 50;
}

.fab-wrapper {
    position: relative;
}

.fab-button {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: rgba(31, 41, 55, 0.9);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1);
}

.fab-button:hover {
    transform: scale(1.1);
    background: rgba(55, 65, 81, 0.9);
}

.fab-button:active {
    transform: scale(0.95);
}

.fab-button.open {
    transform: rotate(45deg);
}

.fab-button.open:hover {
    transform: rotate(45deg) scale(1.1);
}

.fab-icon {
    transition: opacity 0.2s ease;
}

.radial-menu {
    position: absolute;
    left: 0;
    top: 0;
    width: 200px;
    height: 200px;
    transform: translate(-86px, -86px);
    pointer-events: none;
}

.radial-menu::before {
    content: '';
    position: absolute;
    left: 86px;
    top: 86px;
    width: 140px;
    height: 140px;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
    border-radius: 50%;
    filter: blur(48px);
    animation: pulse 2s infinite;
}

.radial-button {
    position: absolute;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(31, 41, 55, 0.95);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
    animation: fadeInScale 0.3s ease-out forwards;
}

.radial-button:hover {
    transform: translate(-50%, -50%) scale(1.1);
    background: rgba(55, 65, 81, 0.95);
}

.radial-button:active {
    transform: translate(-50%, -50%) scale(0.95);
}

.save-button {
    background: rgba(34, 197, 94, 0.9) !important;
    border-color: rgba(34, 197, 94, 0.5) !important;
}

.save-button:hover {
    background: rgba(34, 197, 94, 1) !important;
    transform: translate(-50%, -50%) scale(1.15) !important;
}

.radial-button:nth-child(1) { animation-delay: 0ms; }
.radial-button:nth-child(2) { animation-delay: 50ms; }
.radial-button:nth-child(3) { animation-delay: 100ms; }
.radial-button:nth-child(4) { animation-delay: 150ms; }
.radial-button:nth-child(5) { animation-delay: 200ms; }
.radial-button:nth-child(6) { animation-delay: 250ms; }

/* Helper Tooltip */
.helper-tooltip {
    position: fixed;
    bottom: 24px;
    right: 24px;
    color: rgba(255, 255, 255, 0.6);
    font-size: 14px;
    user-select: none;
}

.helper-content {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(12px);
    padding: 12px 16px;
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.06);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}

.pulse-dot {
    width: 8px;
    height: 8px;
    background: #60a5fa;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.helper-icon {
    color: #60a5fa;
}

/* Animations */
@keyframes fadeInScale {
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .settings-panel {
        width: 90vw;
        padding: 20px;
    }
    
    .fab-container {
        top: 20px;
        left: 20px;
    }
    
    .helper-tooltip {
        bottom: 20px;
        right: 20px;
    }
}
    </style>
</head>
<body>
    <div id="container" class="container">
        <!-- Grid background -->
        <div class="grid-background"></div>
        
        <!-- Drawing canvas -->
        <canvas id="canvas" class="drawing-canvas"></canvas>
        
        <!-- Content boxes will be inserted here -->
        <div id="boxes-container"></div>
        
        <!-- Top settings panel -->
        <div id="settings-panel" class="settings-panel hidden">
            <!-- Settings content will be dynamically inserted -->
        </div>
        
        <!-- Floating action button with radial menu -->
        <div class="fab-container">
            <div class="fab-wrapper">
                <button id="fab-button" class="fab-button">
                    <svg class="fab-icon fab-plus" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    <svg class="fab-icon fab-x hidden" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
                
                <!-- Radial menu buttons -->
                <div id="radial-menu" class="radial-menu hidden">
                    <button class="radial-button" data-mode="draw" data-angle="180" title="Rajzolás">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                        </svg>
                    </button>
                    
                    <button class="radial-button" data-mode="text" data-angle="135" title="Szöveg">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="4 7 4 4 20 4 20 7"/>
                            <line x1="9" y1="20" x2="15" y2="20"/>
                            <line x1="12" y1="4" x2="12" y2="20"/>
                        </svg>
                    </button>
                    
                    <button class="radial-button" data-mode="link" data-angle="90" title="Hivatkozás">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                        </svg>
                    </button>
                    
                    <button class="radial-button" data-mode="image" data-angle="45" title="Kép beillesztése">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                            <circle cx="9" cy="9" r="2"/>
                            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                        </svg>
                    </button>
                    
                    <button class="radial-button" data-mode="erase" data-angle="0" title="Radír">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M7 21h10"/>
                            <path d="M19 21v-8a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v8"/>
                            <path d="M7 10V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v4"/>
                        </svg>
                    </button>
                    
                    <!-- Save button -->
                    <button class="radial-button save-button" data-mode="save" data-angle="225" title="Mentés GitHub-ra">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17,21 17,13 7,13 7,21"/>
                            <polyline points="7,3 7,8 15,8"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Hidden file input -->
        <input type="file" id="file-input" accept="image/*" class="hidden">
        
        <!-- Helper tooltip -->
        <div class="helper-tooltip">
            <div class="helper-content">
                <div class="pulse-dot"></div>
                <span>Kattints a </span>
                <svg class="helper-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                <span> gombra az eszközökhöz</span>
            </div>
        </div>
                        <select class="style-select" onchange="notebook.brushStyle = this.value">
                            <option value="round" ${this.brushStyle === 'round' ? 'selected' : ''}>Kerek</option>
                            <option value="square" ${this.brushStyle === 'square' ? 'selected' : ''}>Négyzet</option>
                        </select>
                    </div>
                    
                    <div class="quick-colors">
                        <div class="quick-colors-label">Gyors színek</div>
                        <div class="quick-colors-grid">
                            <button class="quick-color-btn white" onclick="notebook.brushColor = '#ffffff'; notebook.renderSettings();">Fehér</button>
                            <button class="quick-color-btn yellow" onclick="notebook.brushColor = '#ffcc00'; notebook.renderSettings();">Sárga</button>
                            <button class="quick-color-btn green" onclick="notebook.brushColor = '#00cc99'; notebook.renderSettings();">Zöld</button>
                            <button class="quick-color-btn red" onclick="notebook.brushColor = '#ff4444'; notebook.renderSettings();">Piros</button>
                        </div>
                    </div>
                </div>
            `;
        } else if (this.mode === 'text') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container text">
                            <svg class="settings-icon text" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="4 7 4 4 20 4 20 7"/>
                                <line x1="9" y1="20" x2="15" y2="20"/>
                                <line x1="12" y1="4" x2="12" y2="20"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Szöveg mód</span>
                    </div>
                    <button class="settings-close-btn" onclick="notebook.closeSettings();">Bezár</button>
                </div>
                
                <div class="settings-content">
                    <div class="info-box">
                        <div class="info-item">
                            <div class="info-icon-container green">
                                <span style="font-size: 14px;">📝</span>
                            </div>
                            <p class="info-text">Kattints bárhová a vászonra új szövegdoboz létrehozásához</p>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-icon-container blue">
                                <span style="font-size: 14px;">✏️</span>
                            </div>
                            <p class="info-text">A doboz kiválasztása után további formázási lehetőségek jelennek meg</p>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-icon-container purple">
                                <span style="font-size: 14px;">🎨</span>
                            </div>
                            <p class="info-text">Szín, méret, betűtípus és szélesség mind módosítható</p>
                        </div>
                    </div>
                </div>
            `;
        } else if (this.mode === 'link') {
            content = `
                <div class="settings-header">
                    <div class="settings-title">
                        <div class="settings-icon-container link">
                            <svg class="settings-icon link" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                            </svg>
                        </div>
                        <span class="settings-title-text">Hivatkozás mód</span>
                    </div>
                    <button class="settings-close-btn" onclick="notebook.closeSettings();">Bezár</button>
                </div>
                
                <div class="settings-content">
                    <div class="info-box">
                        <p style="margin-bottom: 8px; color: rgba(255,255,255,0.9); font-weight: 500;">🔗 Kattints a vászonra hivatkozás hozzáadásához</p>
                        <p style="color: rgba(255,255,255,0.9); font-weight: 500;">🌐 Add meg az URL-t a megjelenő párbeszédablakban</p>
                    </div>
                </div>
            `;
        }
        
        this.settingsPanel.innerHTML = content;
    }
    
    eraseAt(pos) {
        const radius = Math.max(8, this.brushSize * 1.2);
        this.strokes = this.strokes.filter(stroke => {
            for (const point of stroke.points) {
                const dx = point.x - pos.x;
                const dy = point.y - pos.y;
                if (dx * dx + dy * dy <= radius * radius) {
                    return false;
                }
            }
            return true;
        });
        this.redrawCanvas();
    }
    
    addTextAt(pos) {
        console.log('Adding text at:', pos);
        const snapped = this.snapToGrid(pos.x, pos.y);
        const id = Date.now() + Math.random();
        const box = {
            id,
            type: 'text',
            x: snapped.x,
            y: snapped.y,
            width: 280,
            height: 80,
            text: 'Írj ide',
            color: '#ffffff',
            fontSize: 16,
            fontFamily: 'sans-serif',
            fontWeight: '400',
            fontStyle: 'normal'
        };
        
        this.boxes.push(box);
        this.selectedBox = id;
        this.mode = 'none'; // Reset mode but keep settings open
        this.render();
        console.log('Text box added:', box);
    }
    
    addLinkAt(pos) {
        console.log('Adding link at:', pos);
        const url = prompt('Hivatkozás URL (https://...)');
        if (!url) return;
        
        const snapped = this.snapToGrid(pos.x, pos.y);
        const id = Date.now() + Math.random();
        const box = {
            id,
            type: 'link',
            x: snapped.x,
            y: snapped.y,
            width: 260,
            height: 40,
            url,
            text: url,
            color: '#9be2ff'
        };
        
        this.boxes.push(box);
        this.selectedBox = id;
        this.mode = 'none'; // Reset mode but keep settings open
        this.render();
        console.log('Link box added:', box);
    }
    
    handleImageFile(file) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const src = ev.target.result;
            const pos = this.snapToGrid(this.lastPointer.x, this.lastPointer.y);
            const id = Date.now() + Math.random();
            const box = {
                id,
                type: 'image',
                x: pos.x - 80,
                y: pos.y - 60,
                width: 160,
                height: 120,
                src
            };
            
            this.boxes.push(box);
            this.selectedBox = id;
            this.setMode('none');
            this.render();
        };
        reader.readAsDataURL(file);
    }
    
    updateBox(id, updates) {
        const index = this.boxes.findIndex(b => b.id === id);
        if (index !== -1) {
            this.boxes[index] = { ...this.boxes[index], ...updates };
            this.render();
        }
    }
    
    deleteSelectedBox() {
        if (!this.selectedBox) return;
        this.boxes = this.boxes.filter(b => b.id !== this.selectedBox);
        this.selectedBox = null;
        this.closeSettings();
        this.render();
    }
    
    selectBox(id) {
        this.selectedBox = id;
        this.renderSettings();
        this.render();
    }
    
    startDragBox(id, startPos) {
        const box = this.boxes.find(b => b.id === id);
        if (!box) return;
        
        this.dragState = {
            id,
            dragging: true,
            startX: startPos.x,
            startY: startPos.y,
            origX: box.x,
            origY: box.y
        };
        
        this.selectBox(id);
    }
    
    async saveToGitHub() {
        try {
            // Get GitHub token from user
            const token = prompt('GitHub Personal Access Token (needed to save):');
            if (!token) return;
            
            const repo = prompt('Repository name (e.g., "username/my-notebook"):');
            if (!repo) return;
            
            const filename = prompt('File name (e.g., "my-drawing.json"):', 'notebook-' + new Date().toISOString().slice(0,10) + '.json');
            if (!filename) return;
            
            // Prepare data to save
            const saveData = {
                timestamp: new Date().toISOString(),
                strokes: this.strokes,
                boxes: this.boxes,
                settings: {
                    brushSize: this.brushSize,
                    brushColor: this.brushColor,
                    brushStyle: this.brushStyle
                }
            };
            
            // Convert canvas to base64 image for preview
            const canvasDataURL = this.canvas.toDataURL('image/png');
            saveData.preview = canvasDataURL;
            
            const content = JSON.stringify(saveData, null, 2);
            const encodedContent = btoa(unescape(encodeURIComponent(content)));
            
            // GitHub API request
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${token}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: `Save notebook: ${filename}`,
                    content: encodedContent,
                    branch: 'main'
                })
            });
            
            if (response.ok) {
                const result = await response.json();
                alert(`✅ Successfully saved to GitHub!\n\nFile: ${filename}\nURL: ${result.content.html_url}`);
                
                // Show success notification
                this.showNotification('✅ Saved to GitHub!', 'success');
            } else {
                const error = await response.json();
                console.error('GitHub API Error:', error);
                alert(`❌ Error saving to GitHub: ${error.message}`);
                this.showNotification('❌ Save failed', 'error');
            }
            
        } catch (error) {
            console.error('Save error:', error);
            alert(`❌ Error: ${error.message}`);
            this.showNotification('❌ Save failed', 'error');
        }
    }
    
    async loadFromGitHub() {
        try {
            const repo = prompt('Repository name (e.g., "username/my-notebook"):');
            if (!repo) return;
            
            const filename = prompt('File name to load:');
            if (!filename) return;
            
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`);
            
            if (response.ok) {
                const result = await response.json();
                const content = atob(result.content);
                const saveData = JSON.parse(content);
                
                // Load data
                this.strokes = saveData.strokes || [];
                this.boxes = saveData.boxes || [];
                if (saveData.settings) {
                    this.brushSize = saveData.settings.brushSize || 3;
                    this.brushColor = saveData.settings.brushColor || '#ffffff';
                    this.brushStyle = saveData.settings.brushStyle || 'round';
                }
                
                // Refresh display
                this.redrawCanvas();
                this.render();
                
                this.showNotification('✅ Loaded from GitHub!', 'success');
                alert(`✅ Successfully loaded: ${filename}`);
            } else {
                alert('❌ File not found or access denied');
                this.showNotification('❌ Load failed', 'error');
            }
            
        } catch (error) {
            console.error('Load error:', error);
            alert(`❌ Error: ${error.message}`);
            this.showNotification('❌ Load failed', 'error');
        }
    }
    
    showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            background: ${type === 'success' ? 'rgba(34, 197, 94, 0.9)' : type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 'rgba(59, 130, 246, 0.9)'};
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 500;
            z-index: 1000;
            backdrop-filter: blur(12px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 100);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.transform = 'translateX(400px)';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }
        // Clear existing boxes
        this.boxesContainer.innerHTML = '';
        
        // Render all boxes
        this.boxes.forEach(box => {
            const boxElement = document.createElement('div');
            boxElement.className = 'notebook-box';
            if (this.selectedBox === box.id) {
                boxElement.classList.add('selected');
            }
            
            boxElement.dataset.id = box.id;
            boxElement.style.left = box.x + 'px';
            boxElement.style.top = box.y + 'px';
            boxElement.style.width = box.width + 'px';
            boxElement.style.height = box.height + 'px';
            
            if (box.type === 'text') {
                const textarea = document.createElement('textarea');
                textarea.className = 'text-box-content';
                textarea.value = box.text;
                textarea.placeholder = 'Írj ide...';
                textarea.style.color = box.color;
                textarea.style.fontSize = box.fontSize + 'px';
                textarea.style.fontFamily = box.fontFamily;
                textarea.style.fontWeight = box.fontWeight;
                textarea.style.fontStyle = box.fontStyle;
                
                textarea.addEventListener('input', (e) => {
                    this.updateBox(box.id, { text: e.target.value });
                });
                
                textarea.addEventListener('focus', () => {
                    this.selectBox(box.id);
                });
                
                boxElement.appendChild(textarea);
                
            } else if (box.type === 'link') {
                const linkElement = document.createElement('div');
                linkElement.className = 'link-box-content';
                linkElement.style.color = box.color;
                
                linkElement.innerHTML = `
                    <svg class="link-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                    ${box.text}
                `;
                
                linkElement.addEventListener('click', () => {
                    this.selectBox(box.id);
                });
                
                linkElement.addEventListener('dblclick', () => {
                    window.open(box.url, '_blank');
                });
                
                boxElement.appendChild(linkElement);
                
            } else if (box.type === 'image') {
                const img = document.createElement('img');
                img.className = 'image-box-content';
                img.src = box.src;
                img.alt = 'img';
                
                img.addEventListener('click', () => {
                    this.selectBox(box.id);
                });
                
                boxElement.appendChild(img);
            }
            
            // Add drag functionality
            boxElement.addEventListener('pointerdown', (e) => {
                if (e.target.closest('.text-box-content')) return; // Don't drag when editing text
                
                const pos = this.getPointerPos(e);
                this.startDragBox(box.id, pos);
                boxElement.setPointerCapture && boxElement.setPointerCapture(e.pointerId);
            });
            
            this.boxesContainer.appendChild(boxElement);
        });
    }
}

// Initialize the notebook
let notebook;
document.addEventListener('DOMContentLoaded', () => {
    notebook = new LearningNotebook();
    console.log('Notebook initialized:', notebook);
});
    </script>
</body>
</html>
